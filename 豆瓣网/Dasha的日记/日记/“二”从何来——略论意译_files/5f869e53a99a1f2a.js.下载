
            Do(function(){
              !function(){function e(){this.init()}var o=$(document),i=$("html"),n=$("body"),t={display_close:!0},s=['<div class="ui-overlay-mask" style="display:none;">','<div class="ui-overlay-x"></div>                   ','<div class="ui-overlay-container">                 ','  <a href="#" class="ui-overlay-close" style="display:none;">&times;</a> ','  <div class="hd"></div>                   ','  <div class="bd"></div>                   ',"</div>                                     ","</div>                                     "].join(""),a='<div class="ui-overlay-anchor"></div>';e.prototype={init:function(){var e=this;this.config=t,this.mask=$(s).appendTo(n),this.anchor=$(a).prependTo(n),this.container=this.mask.find(".ui-overlay-container"),this.header=this.mask.find(".ui-overlay-container > .hd"),this.body=this.mask.find(".ui-overlay-container > .bd"),this.bnClose=this.mask.find(".ui-overlay-container > .ui-overlay-close"),this.bnClose.click(function(o){o.preventDefault(),e.close()}),o.delegate(".ui-overlay-mask","click",function(o){e.config.forbidden_mask_click||o.target==e.container[0]||$.contains(e.container[0],o.target)||e.close()}),o.bind("keyup",function(o){e.config.forbidden_hotkey_cancel||/input|textarea/i.test(o.target.tagName)||27!==o.keyCode||e.close()})},open:function(e,n){var t=this.docTop=o.scrollTop();this.anchor.show().css({marginTop:-t}),i.addClass("ui-overlay-show"),this.mask.show(),this.config.display_close&&this.bnClose.show(),this.setContent(e||""),n&&n.call(this),this.container.trigger("overlay:open")},close:function(){i.removeClass("ui-overlay-show"),this.anchor.hide(),o.scrollTop(this.docTop),this.mask.hide(),this.container.trigger("overlay:close")},bind:function(e,o){this.container.bind(e,o)},setConfig:function(e){this.config=$.extend({},t,e||{})},setHeader:function(e){this.header.html(e)},setContent:function(e){this.body.html(e)}},$.overlay||($.overlay=new e)}(),function(){function e(e,o,i){var n=curTime=new Date;n.setTime(curTime.getTime()+i),document.cookie=e+"="+escape(o)+(null==i?"":";expires="+n.toGMTString())+";domain=.douban.com;path=/"}function o(e){if(document.cookie.length>0){var o,i=document.cookie.indexOf(e+"=");if(i!=-1)return i=i+e.length+1,o=document.cookie.indexOf(";",i),o==-1&&(o=document.cookie.length),unescape(document.cookie.substring(i,o))}return""}var i='<iframe src="javascript:;" frameborder="0" scrolling="no" width="{{width}}" height="{{height}}" name="{{name}}"></iframe>',n=478,t=480,s=function(e,o,i){var n={login:"https://accounts.douban.com/popup/login?source=sns",reg:"https://accounts.douban.com/popup/login?source=sns#popup_register",switch_user:"https://accounts.douban.com/popup/login?source=sns"},t=$.overlay.body.find("iframe");t.attr("src",n[e])},a=function(s){return function(a){a.preventDefault();var c=$(this),r=c.data(),l=r.params?"function"==typeof window[r.params]?window[r.params].call(this):r.params:null,d=self.location.href;l&&(d=d.indexOf("?")+1?d+"&"+l:d+"?"+l),r.width>$("body").width()&&(r.width=$("body").width());var h=i.replace("{{width}}",r.width||n).replace("{{height}}",r.height||t).replace("{{name}}",document.location.protocol+"//"+document.location.hostname);"undefined"!=typeof r.key&&o(r.key)||($.overlay.open(h,function(){s(encodeURIComponent(d),r.source)}),r.key&&r.cookie&&r.expired&&$.overlay.bind("overlay:close",function(){e(r.key,r.cookie,r.expired)}))}};$(document).delegate(".lnk-show-login","click",a(function(e,o){s("login",e,o)})).delegate(".lnk-show-reg","click",a(function(e,o){s("reg",e,o)})).delegate(".lnk-switch-user","click",a(function(e,o){s("switch_user",encodeURIComponent(e),o)})),$(window).bind("message",function(e){"https://accounts.douban.com"===e.originalEvent.origin&&$.overlay.body.find("iframe").css("height",e.originalEvent.data)})}();
            });
        